CREATE OR REPLACE PACKAGE BODY cursores_mma IS

    -- Procedimiento: Listar peleas de un evento
    PROCEDURE listar_peleas_evento (p_evento_id NUMBER) IS
        CURSOR c_pelea_evento IS
            SELECT
                p.id_pelea,
                p.resultado,
                p.ganador,
                e.nombre AS nombre_evento,
                e.fecha  AS fecha_evento
            FROM
                pelea p
            JOIN
                evento e ON p.id_evento = e.id_evento
            WHERE
                p.id_evento = p_evento_id;

        v_pelea_record c_pelea_evento%ROWTYPE;
    BEGIN
        OPEN c_pelea_evento;

        DBMS_OUTPUT.PUT_LINE('--- Listado de peleas para el evento ID: ' || p_evento_id || ' ---');

        LOOP
            FETCH c_pelea_evento INTO v_pelea_record;
            EXIT WHEN c_pelea_evento%NOTFOUND;

            DBMS_OUTPUT.PUT_LINE('Pelea ID: ' || v_pelea_record.id_pelea);
            DBMS_OUTPUT.PUT_LINE('  - Evento: ' || v_pelea_record.nombre_evento);
            DBMS_OUTPUT.PUT_LINE('  - Fecha: ' || v_pelea_record.fecha_evento);
            DBMS_OUTPUT.PUT_LINE('  - Resultado: ' || v_pelea_record.resultado);
            DBMS_OUTPUT.PUT_LINE('  - Ganador ID: ' || v_pelea_record.ganador);
            DBMS_OUTPUT.PUT_LINE('--------------------------------------------------');
        END LOOP;

        CLOSE c_pelea_evento;
    END listar_peleas_evento;


    -- Procedimiento: Listar peleadores por victorias
    PROCEDURE listar_peleadores_victorias (p_min_victorias NUMBER, p_categoria_id NUMBER) IS
        CURSOR c_peleadores_filtrados_victorias IS
            SELECT
                p.nombre,
                cp.nombre AS nombre_categoria,
                p.victorias
            FROM
                peleador p
            JOIN
                categoria_peso cp ON p.id_categoria = cp.id_categoria
            WHERE
                p.id_categoria = p_categoria_id
                AND p.victorias >= p_min_victorias;

        v_peleador_info c_peleadores_filtrados_victorias%ROWTYPE;
    BEGIN
        OPEN c_peleadores_filtrados_victorias;

        DBMS_OUTPUT.PUT_LINE('--- Buscando peleadores con ' || p_min_victorias ||
                             ' o más victorias en la categoría ID ' || p_categoria_id || ' ---');

        LOOP
            FETCH c_peleadores_filtrados_victorias INTO v_peleador_info;
            EXIT WHEN c_peleadores_filtrados_victorias%NOTFOUND;

            DBMS_OUTPUT.PUT_LINE('Nombre: ' || v_peleador_info.nombre);
            DBMS_OUTPUT.PUT_LINE('  - Categoría de peso: ' || v_peleador_info.nombre_categoria);
            DBMS_OUTPUT.PUT_LINE('  - Victorias: ' || v_peleador_info.victorias);
            DBMS_OUTPUT.PUT_LINE('--------------------------------------------------');
        END LOOP;

        CLOSE c_peleadores_filtrados_victorias;
    END listar_peleadores_victorias;

END cursores_mma;
/

